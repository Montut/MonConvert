<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Montut Convert Tools - Free Online Video & Audio Converter</title>
    <meta name="description" content="Convert videos to MP4, extract audio (MP3, AAC, WAV), or convert audio formats online for free with Montut Convert Tools. Client-side processing for privacy.">
    <meta name="robots" content="index, follow">
    <meta name="google-site-verification" content="8RYRvs2QcMKlrWuWhaBizLfal7Fc-cRjqIXHHQnBNNY" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Montut Convert Tools - Free Online Video & Audio Converter">
    <meta property="og:description" content="Client-side video to MP4, audio extraction, and audio format conversion. Secure and fast.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://montutconverttools.com/">
    <meta property="og:site_name" content="Montut Convert Tools">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Montut Convert Tools - Free Online Video & Audio Converter">
    <meta name="twitter:description" content="Client-side video to MP4, audio extraction, and audio format conversion. Secure and fast.">

    <style>
        :root {
            --primary-color: #4a90e2; --primary-hover: #357abd; --secondary-color: #f5a623;
            --success-color: #7ed321; --success-hover: #68b318; --light-gray: #f8f9fa;
            --medium-gray: #e9ecef; --dark-gray: #6c757d; --text-color: #343a40;
            --white: #fff; --danger-color: #dc3545;
            --header-gradient: linear-gradient(135deg, #4a90e2 0%, #63a4ff 100%);
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--light-gray); margin: 0; color: var(--text-color); line-height: 1.6; }
        .page-header { background: var(--header-gradient); color: var(--white); padding: 40px 20px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .page-header h1 { margin: 0; font-size: 2.5em; font-weight: 600; }
        .page-header p { margin-top: 5px; font-size: 1.1em; opacity: 0.9; }
        .main-content { max-width: 1100px; margin: 40px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr; gap: 40px; }
        @media (min-width: 992px) { .main-content { grid-template-columns: 2fr 1fr; } }
        .converter-section, .info-section, .stats-section, .how-to-section { background-color: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--box-shadow); }
        h2 { color: var(--primary-color); margin-top: 0; margin-bottom: 20px; font-size: 1.6em; border-bottom: 2px solid var(--medium-gray); padding-bottom: 10px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark-gray); font-size: 0.95em; }
        input[type="file"], select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid var(--medium-gray); border-radius: 6px; font-size: 1em; background-color: #fdfdfd; }
        input[type="file"] { border: 2px dashed var(--medium-gray); background-color: var(--light-gray); text-align: center; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease; }
        input[type="file"]:hover { background-color: var(--medium-gray); border-color: var(--primary-color); }
        input[type="file"]::file-selector-button { background-color: var(--primary-color); color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition: background-color 0.3s ease; margin-right: 10px; }
        input[type="file"]::file-selector-button:hover { background-color: var(--primary-hover); }
        button#convertButton { background-color: var(--primary-color); color: white; padding: 14px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: background-color 0.3s ease, transform 0.1s ease; width: 100%; margin-top: 10px; }
        button#convertButton:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button#convertButton:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; }
        #status { margin-top: 25px; padding: 15px; background-color: var(--light-gray); border-radius: 6px; min-height: 50px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 500; color: var(--dark-gray); border: 1px solid var(--medium-gray); }
        #status.status-error { color: var(--danger-color); border-color: var(--danger-color); background-color: #f8d7da; }
        #status.status-success { color: #155724; border-color: var(--success-color); background-color: #d4edda; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 24px; height: 24px; border-radius: 50%; border-left-color: var(--primary-color); animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #downloadLink { display: none; margin-top: 20px; padding: 14px 25px; background-color: var(--success-color); color: white; text-decoration: none; border-radius: 6px; transition: background-color 0.3s ease; font-size: 1.1em; font-weight: 600; text-align: center; }
        #downloadLink:hover { background-color: var(--success-hover); }
        progress#progressBar { width: 100%; margin-top: 15px; height: 10px; display: none; border-radius: 5px; overflow: hidden; }
        progress#progressBar::-webkit-progress-bar { background-color: var(--medium-gray); border-radius: 5px; }
        progress#progressBar::-webkit-progress-value { background-color: var(--primary-color); border-radius: 5px; transition: width 0.1s linear; }
        progress#progressBar::-moz-progress-bar { background-color: var(--primary-color); border-radius: 5px; transition: width 0.1s linear; }
        #outputInfo { margin-top: 15px; padding: 10px 15px; background-color: #e8f6f3; border-left: 4px solid #1abc9c; border-radius: 4px; font-size: 0.9em; display: none; word-wrap: break-word; }
        #outputInfo strong { color: #16a085; }
        .features-list, .how-to-steps { list-style: none; padding: 0; margin: 0; }
        .features-list li, .how-to-steps li { display: flex; align-items: center; margin-bottom: 15px; font-size: 1.05em; }
        .features-list .icon, .how-to-steps .step-number { font-size: 1.5em; margin-right: 15px; color: var(--primary-color); flex-shrink: 0; width: 30px; text-align: center; }
        .how-to-steps .step-number { background-color: var(--primary-color); color: white; border-radius: 50%; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; font-size: 0.9em; font-weight: bold; }
        .stats-container { display: flex; justify-content: space-around; text-align: center; margin-top: 20px; }
        .stat-item .number { font-size: 2em; font-weight: 600; color: var(--secondary-color); display: block; }
        .stat-item .label { font-size: 0.9em; color: var(--dark-gray); }
        .page-footer { background-color: var(--text-color); color: var(--medium-gray); padding: 30px 20px; text-align: center; margin-top: 50px; font-size: 0.9em; }
        .page-footer a { color: var(--white); text-decoration: none; margin: 0 10px; transition: color 0.2s ease; }
        .page-footer a:hover { color: var(--primary-color); text-decoration: underline; }
        .page-footer p { margin-top: 15px; margin-bottom: 0; }
        .privacy-disclaimer { font-size: 0.85em; color: var(--dark-gray); background-color: var(--medium-gray); padding: 10px 15px; border-radius: 6px; margin-top: 20px; text-align: left; border-left: 4px solid var(--primary-color); }
        .privacy-disclaimer strong { color: var(--text-color); }
        .donation-section { background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 20px; border-radius: 8px; text-align: center; margin: 30px auto 0 auto; max-width: 600px; }
        .donation-section p { margin: 0 0 15px 0; font-size: 1.05em; }
        .donation-button { display: inline-block; padding: 10px 20px; background-color: var(--secondary-color); color: var(--white); text-decoration: none; border-radius: 20px; font-weight: bold; transition: background-color 0.3s ease, transform 0.1s ease; }
        .donation-button:hover { background-color: #e69500; transform: scale(1.03); }
        .donation-button .icon { margin-right: 8px; }
        @media (max-width: 768px) { .page-header h1 { font-size: 2em; } .main-content { grid-template-columns: 1fr; gap: 30px; margin-top: 30px;} .converter-section, .info-section, .stats-section, .how-to-section { padding: 20px; } h2 { font-size: 1.4em; } .stats-container { flex-direction: column; gap: 15px; } }

        /* Tab Styles */
        .tabs-nav { display: flex; margin-bottom: 20px; border-bottom: 2px solid var(--medium-gray); }
        .tab-button { padding: 10px 20px; cursor: pointer; background-color: transparent; border: none; border-bottom: 3px solid transparent; font-size: 1.05em; color: var(--dark-gray); transition: color 0.2s ease, border-bottom-color 0.2s ease; }
        .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: 600; }
        .tab-button:hover { color: var(--primary-color); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 600px) { .options-grid { grid-template-columns: 1fr 1fr; } } /* Two columns for options on wider screens */
    </style>
    <!-- Google AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5213336778723560" crossorigin="anonymous"></script>
    <!-- Load ffmpeg.wasm -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.0/dist/ffmpeg.min.js"></script>
</head>
<body>

    <header class="page-header">
        <h1>Montut Convert Tools</h1>
        <p>Your simple, fast, and free solution for converting media directly in your browser.</p>
    </header>

    <main class="main-content">
        <section class="converter-section">
            <!-- Tab Navigation -->
            <div class="tabs-nav">
                <button class="tab-button active" data-tab="videoToMp4">Video to MP4</button>
                <button class="tab-button" data-tab="extractAudio">Extract Audio</button>
                <button class="tab-button" data-tab="audioConverter">Audio Converter</button>
            </div>

            <!-- Tab Content Panels -->
            <div id="videoToMp4" class="tab-content active">
                <h2>Convert Video to MP4</h2>
                <form id="videoToMp4Form">
                    <label for="videoFileMp4">1. Choose Video File:</label>
                    <input type="file" id="videoFileMp4" name="videoFile" accept="video/*" required>
                    <div class="options-grid">
                        <div>
                            <label for="compressionLevelMp4">2. Compression Level:</label>
                            <select id="compressionLevelMp4" name="compressionLevel">
                                <option value="medium" selected>Medium (Balance)</option>
                                <option value="high">High (Smaller File)</option>
                                <option value="low">Low (Best Quality)</option>
                            </select>
                        </div>
                        <div>
                            <label for="outputResolutionMp4">3. Output Resolution:</label>
                            <select id="outputResolutionMp4" name="outputResolution">
                                <option value="original" selected>Keep Original</option>
                                <option value="1080p">1080p</option>
                                <option value="720p">720p</option>
                                <option value="480p">480p</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

            <div id="extractAudio" class="tab-content">
                <h2>Extract Audio from Video</h2>
                <form id="extractAudioForm">
                    <label for="videoFileExtract">1. Choose Video File:</label>
                    <input type="file" id="videoFileExtract" name="videoFile" accept="video/*" required>
                    <div>
                        <label for="audioOutputFormatExtract">2. Output Audio Format:</label>
                        <select id="audioOutputFormatExtract" name="audioOutputFormat">
                            <option value="mp3" selected>MP3</option>
                            <option value="aac">AAC</option>
                            <option value="wav">WAV</option>
                            <option value="ogg">OGG (Vorbis)</option>
                        </select>
                    </div>
                </form>
            </div>

            <div id="audioConverter" class="tab-content">
                <h2>Convert Audio Format</h2>
                <form id="audioConverterForm">
                    <label for="audioFileConvert">1. Choose Audio File:</label>
                    <input type="file" id="audioFileConvert" name="audioFile" accept="audio/*" required>
                    <div class="options-grid">
                        <div>
                            <label for="audioOutputFormatConvert">2. Target Audio Format:</label>
                            <select id="audioOutputFormatConvert" name="audioOutputFormat">
                                <option value="mp3" selected>MP3</option>
                                <option value="aac">AAC</option>
                                <option value="wav">WAV</option>
                                <option value="ogg">OGG (Vorbis)</option>
                                <option value="flac">FLAC (Lossless)</option>
                            </select>
                        </div>
                        <div>
                            <label for="audioBitrateConvert">3. Audio Bitrate (for MP3/AAC/OGG):</label>
                            <select id="audioBitrateConvert" name="audioBitrate">
                                <option value="128k" selected>128 kbps (Good)</option>
                                <option value="192k">192 kbps (Better)</option>
                                <option value="256k">256 kbps (High)</option>
                                <option value="320k">320 kbps (Best)</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Shared Convert Button -->
            <button type="button" id="convertButton">🚀 Convert Now</button>

            <div class="privacy-disclaimer">
                <strong>Privacy Note:</strong> Your files are processed <strong>entirely within your browser</strong> using WebAssembly. They are <strong>never uploaded</strong> to our servers, ensuring maximum privacy.
            </div>

            <div id="status">
                <div class="spinner" id="spinner"></div>
                <span id="statusText">Loading converter... Please wait.</span>
            </div>
            <progress id="progressBar" value="0" max="100"></progress>
            <div id="outputInfo"></div>
            <a id="downloadLink" href="#" download>⬇️ Download Converted File</a>
        </section>

        <aside class="sidebar">
            <section class="info-section">
                <h2>Why Choose Us?</h2>
                <ul class="features-list">
                    <li><span class="icon">🔒</span> 100% Private (In-Browser Processing)</li>
                    <li><span class="icon">⚡</span> Fast Client-Side Conversions</li>
                    <li><span class="icon">✨</span> MP4, MP3, AAC, WAV, OGG & More</li>
                    <li><span class="icon">⚙️</span> Customizable Quality Settings</li>
                    <li><span class="icon">📱</span> Mobile Friendly Design</li>
                    <li><span class="icon">📶</span> Works Offline (After first load)</li>
                </ul>
            </section>
            <section class="stats-section">
                 <h2>Our Achievements</h2>
                 <div class="stats-container">
                     <div class="stat-item"><span class="number">1M+</span><span class="label">Operations</span></div>
                     <div class="stat-item"><span class="number">50K+</span><span class="label">Users Trust Us</span></div>
                     <div class="stat-item"><span class="number">100%</span><span class="label">Client-Side</span></div>
                 </div>
            </section>
            <section class="how-to-section">
                <h2>How It Works (Client-Side)</h2>
                <ol class="how-to-steps">
                    <li><span class="step-number">1</span> Select a conversion tab.</li>
                    <li><span class="step-number">2</span> Choose your media file.</li>
                    <li><span class="step-number">3</span> Select desired options.</li>
                    <li><span class="step-number">4</span> Click "Convert Now".</li>
                    <li><span class="step-number">5</span> Download your converted file!</li>
                </ol>
            </section>
        </aside>
    </main>

    <section class="donation-section">
        <p>Enjoy using Montut Convert Tools? Support future development and keep the servers running!</p>
        <a href="https://buymeacoffee.com/montut" target="_blank" rel="noopener noreferrer" class="donation-button">
            <span class="icon">☕</span> Buy Me a Coffee
        </a>
    </section>

    <footer class="page-footer">
        <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms of Service</a> | <a href="#contact">Contact Us</a>
        <p>&copy; 2025 Montut Convert Tools. All rights reserved.</p>
    </footer>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        let ffmpeg;
        let isFFmpegLoaded = false;
        let currentActiveTab = 'videoToMp4'; // Default active tab

        // DOM Elements
        const videoFileMp4Input = document.getElementById('videoFileMp4');
        const compressionLevelMp4Select = document.getElementById('compressionLevelMp4');
        const outputResolutionMp4Select = document.getElementById('outputResolutionMp4');

        const videoFileExtractInput = document.getElementById('videoFileExtract');
        const audioOutputFormatExtractSelect = document.getElementById('audioOutputFormatExtract');

        const audioFileConvertInput = document.getElementById('audioFileConvert');
        const audioOutputFormatConvertSelect = document.getElementById('audioOutputFormatConvert');
        const audioBitrateConvertSelect = document.getElementById('audioBitrateConvert');

        const convertButton = document.getElementById('convertButton');
        const statusText = document.getElementById('statusText');
        const spinner = document.getElementById('spinner');
        const progressBar = document.getElementById('progressBar');
        const outputInfoDiv = document.getElementById('outputInfo');
        const downloadLink = document.getElementById('downloadLink');
        const statusDiv = document.getElementById('status'); // For styling status messages

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // --- Helper Functions ---
        function updateStatus(message, showSpinner = false, statusType = 'info') {
            statusText.textContent = message;
            spinner.style.display = showSpinner ? 'inline-block' : 'none';
            statusDiv.className = 'status'; // Reset classes
            if (statusType === 'success') statusDiv.classList.add('status-success');
            else if (statusType === 'error') statusDiv.classList.add('status-error');
            console.log(`Status (${statusType}): ${message}`);
        }

        const initializeFFmpeg = async () => {
            if (!ffmpeg) {
                ffmpeg = createFFmpeg({ log: true, corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js' });
            }
            if (!ffmpeg.isLoaded()) {
                updateStatus('Loading converter core... (First load may take a moment)', true, 'info');
                convertButton.disabled = true;
                try {
                    await ffmpeg.load();
                    isFFmpegLoaded = true;
                    updateStatus('Converter ready. Select a tab and your file.', false, 'success');
                    convertButton.disabled = false;
                } catch (error) {
                    console.error("Error loading ffmpeg:", error);
                    updateStatus(`Error loading converter: ${error.message}. Try refreshing.`, false, 'error');
                    isFFmpegLoaded = false;
                    convertButton.disabled = true;
                    throw error;
                }
            } else {
                updateStatus('Converter ready.', false, 'success');
                convertButton.disabled = false;
            }
        };

        // --- Tab Switching Logic ---
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentActiveTab = button.getAttribute('data-tab');

                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(currentActiveTab).classList.add('active');

                // Reset common UI elements on tab switch
                resetConversionUI();
                if (isFFmpegLoaded) updateStatus('Converter ready. Select your file.', false, 'success');
                else updateStatus('Loading converter core...', true, 'info');
            });
        });

        function resetConversionUI() {
            downloadLink.style.display = 'none';
            outputInfoDiv.style.display = 'none';
            outputInfoDiv.innerHTML = '';
            progressBar.style.display = 'none';
            progressBar.value = 0;
            // Reset file inputs (optional, but good for UX)
            if(videoFileMp4Input) videoFileMp4Input.value = '';
            if(videoFileExtractInput) videoFileExtractInput.value = '';
            if(audioFileConvertInput) audioFileConvertInput.value = '';
        }


        // --- Main Conversion Logic ---
        convertButton.addEventListener('click', async () => {
            if (!isFFmpegLoaded) {
                updateStatus('Converter not loaded. Please wait or refresh.', false, 'error');
                return;
            }

            let fileInput, originalFileName, command = [], outputExtension, mimeType;
            const brandTag = "_montutconvert"; // Branding tag

            // Determine active tab and get relevant inputs
            if (currentActiveTab === 'videoToMp4') {
                fileInput = videoFileMp4Input.files[0];
                if (!fileInput) { updateStatus('Please select a video file for MP4 conversion.', false, 'error'); return; }
                originalFileName = fileInput.name.substring(0, fileInput.name.lastIndexOf('.')) || fileInput.name;
                outputExtension = 'mp4';
                mimeType = 'video/mp4';
                command = ['-i', `input.${fileInput.name.split('.').pop()}`];
                const compression = compressionLevelMp4Select.value;
                const resolution = outputResolutionMp4Select.value;
                if (compression === 'low') command.push('-crf', '18');
                else if (compression === 'high') command.push('-crf', '28');
                else command.push('-crf', '23');
                if (resolution === '1080p') command.push('-vf', 'scale=-2:1080');
                else if (resolution === '720p') command.push('-vf', 'scale=-2:720');
                else if (resolution === '480p') command.push('-vf', 'scale=-2:480');
                command.push('-c:v', 'libx264', '-preset', 'ultrafast', '-c:a', 'aac', '-b:a', '128k', '-movflags', '+faststart');
            } else if (currentActiveTab === 'extractAudio') {
                fileInput = videoFileExtractInput.files[0];
                if (!fileInput) { updateStatus('Please select a video file to extract audio.', false, 'error'); return; }
                originalFileName = fileInput.name.substring(0, fileInput.name.lastIndexOf('.')) || fileInput.name;
                outputExtension = audioOutputFormatExtractSelect.value;
                mimeType = `audio/${outputExtension === 'ogg' ? 'ogg' : outputExtension}`; // Basic MIME, ogg needs specific handling
                command = ['-i', `input.${fileInput.name.split('.').pop()}`, '-vn']; // -vn for no video
                if (outputExtension === 'mp3') command.push('-acodec', 'libmp3lame', '-q:a', '2');
                else if (outputExtension === 'aac') command.push('-acodec', 'aac', '-b:a', '192k');
                else if (outputExtension === 'wav') command.push('-acodec', 'pcm_s16le');
                else if (outputExtension === 'ogg') command.push('-acodec', 'libvorbis', '-q:a', '4');
            } else if (currentActiveTab === 'audioConverter') {
                fileInput = audioFileConvertInput.files[0];
                if (!fileInput) { updateStatus('Please select an audio file to convert.', false, 'error'); return; }
                originalFileName = fileInput.name.substring(0, fileInput.name.lastIndexOf('.')) || fileInput.name;
                outputExtension = audioOutputFormatConvertSelect.value;
                const bitrate = audioBitrateConvertSelect.value;
                mimeType = `audio/${outputExtension === 'ogg' ? 'ogg' : outputExtension}`;
                command = ['-i', `input.${fileInput.name.split('.').pop()}`];
                if (outputExtension === 'mp3') command.push('-acodec', 'libmp3lame', '-b:a', bitrate);
                else if (outputExtension === 'aac') command.push('-acodec', 'aac', '-b:a', bitrate);
                else if (outputExtension === 'wav') command.push('-acodec', 'pcm_s16le');
                else if (outputExtension === 'ogg') command.push('-acodec', 'libvorbis', '-b:a', bitrate);
                else if (outputExtension === 'flac') command.push('-acodec', 'flac');
            } else {
                updateStatus('Invalid conversion type selected.', false, 'error');
                return;
            }

            const inputFileNameFFmpeg = `input.${fileInput.name.split('.').pop() || 'tmp'}`;
            const outputFileNameFFmpeg = `output.${outputExtension}`;
            const downloadFileName = `${originalFileName}${brandTag}.${outputExtension}`;

            convertButton.disabled = true;
            convertButton.innerHTML = 'Processing...';
            resetConversionUI(); // Clear previous results before new conversion
            updateStatus(`Loading file "${fileInput.name}"...`, true, 'info');

            try {
                const fileData = await fetchFile(fileInput);
                ffmpeg.FS('writeFile', inputFileNameFFmpeg, fileData);

                ffmpeg.setProgress(({ ratio }) => {
                    if (ratio >= 0 && ratio <= 1) {
                        progressBar.style.display = 'block';
                        progressBar.value = ratio * 100;
                        updateStatus(`Converting... ${Math.round(ratio * 100)}%`, true, 'info');
                    }
                });

                updateStatus('Starting conversion... (This can take time)', true, 'info');
                const startTime = performance.now();
                command.push(outputFileNameFFmpeg); // Add output file to command
                console.log("Running FFmpeg command:", command.join(' '));
                await ffmpeg.run(...command);
                const endTime = performance.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                updateStatus('Conversion finished. Preparing download...', false, 'success');
                progressBar.style.display = 'none';
                const data = ffmpeg.FS('readFile', outputFileNameFFmpeg);
                const blob = new Blob([data.buffer], { type: mimeType });
                const url = URL.createObjectURL(blob);

                downloadLink.href = url;
                downloadLink.download = downloadFileName;
                downloadLink.style.display = 'block';

                const outputFileSize = (blob.size / 1024 / 1024).toFixed(2);
                outputInfoDiv.innerHTML = `
                    <strong>Conversion Details:</strong><br>
                    Original: ${fileInput.name} (${(fileInput.size / 1024 / 1024).toFixed(2)} MB)<br>
                    Output: ${downloadFileName} (${outputFileSize} MB)<br>
                    Time: ${duration} seconds
                `;
                outputInfoDiv.style.display = 'block';
                updateStatus('Done! Click download link.', false, 'success');

                ffmpeg.FS('unlink', inputFileNameFFmpeg);
                ffmpeg.FS('unlink', outputFileNameFFmpeg);

            } catch (error) {
                console.error('Conversion Error:', error);
                updateStatus(`Error: ${error.message}. Check console.`, false, 'error');
                progressBar.style.display = 'none';
            } finally {
                convertButton.disabled = false;
                convertButton.innerHTML = '🚀 Convert Now';
                ffmpeg.setProgress(() => {}); // Clear progress handler
            }
        });

        // Initialize FFmpeg on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeFFmpeg();
            if (typeof SharedArrayBuffer === 'undefined') {
                console.warn("SharedArrayBuffer is not available.");
                updateStatus('Warning: Browser performance might be limited (SharedArrayBuffer missing).', false, 'error');
            }
            // Set initial active tab display
            document.getElementById(currentActiveTab).classList.add('active');
        });

    </script>
</body>
</html>
